---
title: "STA_138"
author: "Charles Chien"
date: "12/14/2020"
output: pdf_document
---

# Import & Modifying Dataset
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#import dataset
library(readr)
Byssinosis <- read_csv("Byssinosis.csv")
Byssinosis$Workspace <- as.factor(Byssinosis$Workspace)

library(ISLR)
attach(Byssinosis)
smp_siz = floor(0.75*nrow(Byssinosis))

set.seed(123)  
train_ind = sample(seq_len(nrow(Byssinosis)),size = smp_siz)  
train =Byssinosis[train_ind,] 
test=Byssinosis[-train_ind,]

#create response variable for train
response_train = cbind(train$Byssinosis, train$`Non-Byssinosis`)

#create response variable for test
response_test = cbind(test$Byssinosis, test$`Non-Byssinosis`)

```

# Variable Selection

## Using Forward AIC
```{r}
forward_AIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "forward")
forward_AIC
```

Final Model: response_train ~ Workspace + Smoking + Employment + Workspace:Smoking

## Using Both AIC
```{r}
both_AIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "both")
both_AIC
```

Final Model:  response_train ~ Workspace + Smoking + Employment + Workspace:Smoking

## USing Forward BIC
```{r}
forward_BIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "forward",
     k = log(dim(train)[1]))
forward_BIC
```

Final Model: formula = response_train ~ Workspace + Smoking + Employment

## Using Both BIC
```{r}
both_BIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "both",
     k = log(dim(train)[1]))
both_BIC
```

Final Model: response_train ~ Workspace + Smoking + Employment


```{r}
Byssinosis1 <- aggregate(response_test ~ Workspace + Smoking + Employment+ Workspace:Smoking,FUN = sum, data = test)

fitGrouped <- glm(cbind(V1,V2) ~ Workspace + Smoking + Employment + Workspace:Smoking, binomial, Byssinosis1)
summary(fitGrouped)

1-pchisq(0.18839, 2)
```

```{r}
Byssinosis2 <- aggregate(response_test ~ Workspace + Smoking + Employment,FUN = sum, data = test)

fitGrouped2 <- glm(cbind(V1,V2)~Workspace + Smoking + Employment, binomial, Byssinosis2)
summary(fitGrouped2)

1-pchisq(0.63761, 4)
```


```{r}
ry <- residuals(fitGrouped2, type = "deviance")
rx <- fitted.values(fitGrouped2)
rxy <- cbind (fitted = rx, residual = ry)
plot(rxy)
```




