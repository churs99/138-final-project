---
title: "STA_138"
author: "Charles Chien"
date: "12/14/2020"
output: pdf_document
---

# Import & Modifying Dataset
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#import dataset
library(readr)
Byssinosis <- read_csv("Byssinosis.csv")
Byssinosis$Workspace <- as.factor(Byssinosis$Workspace)

library(ISLR)
library(ggplot2)
attach(Byssinosis)
smp_siz = floor(0.75*nrow(Byssinosis))

set.seed(123)  
train_ind = sample(seq_len(nrow(Byssinosis)),size = smp_siz)  
train =Byssinosis[train_ind,] 
test=Byssinosis[-train_ind,]

#create response variable for train
response_train = cbind(train$Byssinosis, train$`Non-Byssinosis`)

#create response variable for test
response_test = cbind(test$Byssinosis, test$`Non-Byssinosis`)
```
## Exploratory Data Analysis



# Variable Selection


## USing Forward BIC
```{r}
forward_BIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "forward",
     k = log(dim(train)[1]))
forward_BIC
```

Final Model: formula = response_train ~ Workspace + Smoking + Employment

## Using Both BIC
```{r}
both_BIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "both",
     k = log(dim(train)[1]))
both_BIC
```

Final Model: response_train ~ Workspace + Smoking + Employment


```{r}
Byssinosis1 <- aggregate(response_test ~ Workspace + Smoking + Employment,FUN = sum, data = test)

fitGrouped <- glm(cbind(V1,V2) ~ Workspace + Smoking + Employment, binomial, Byssinosis1)
summary(fitGrouped)

1-pchisq(0.63761, 4)
```

```{r}
Byssinosis2 <- aggregate(response_test ~ Workspace + Smoking + Employment +Workspace:Smoking + Workspace:Employment + Smoking:Employment,FUN = sum, data = test)

fitGrouped2 <- glm(cbind(V1,V2)~Workspace + Smoking + Employment +Workspace:Smoking + Workspace:Employment + Smoking:Employment, binomial, Byssinosis2)
summary(fitGrouped2)

1-pchisq(5.1934e-10, 0)
```












