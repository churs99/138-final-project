---
title: "STA_138_Final_Project"
author: "Edwin Que, Charles Chien"
date: "12/14/2020"
output: pdf_document
---

# 1. Introduction

In 1973, a large cotton textile company in North Carolina participated in a study to investigate the prevalence of byssinosis, a form of pneumoconiosis to which workers exposed to cotton dust are subject. Data was collected on 5,419 workers, including:

Type of work place [1 (most dusty), 2 (less dusty), 3 (least dusty)]
Employment, years [< 10, 10–19, 20–]
Smoking [Smoker, or not in last 5 years]
Sex [Male, Female]
Race [White, Other]
Byssinosis [Yes, No]

Our task is to investigate relationships between this disease on the one hand and smoking status, sex, race, length of employment, smoking, and dustiness of workplace on the other.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#libraries and setseed
library(readr)
library(ISLR)
library(ggplot2)
set.seed(123)

#import dataset
Byssinosis <- read_csv("Byssinosis.csv")

#turn numerical variable into factor
Byssinosis$Workspace <- as.factor(Byssinosis$Workspace)

#make long data from wide data
yes <- Byssinosis$Byssinosis
no <- Byssinosis$`Non-Byssinosis`
yesInd <- c(
  rep(0,sum(no)),
  rep(1,sum(yes))
  )
longdata <- rbind(
  Byssinosis[rep(1:72,no),1:5],
  Byssinosis[rep(1:72,yes),1:5]
)
longdata$y <- yesInd

#create train and test datasets using 50-50 split on long data
trainIndex <- sample(5419, 2710)
train = longdata[trainIndex,] 
test = longdata[-trainIndex,]

##create "yes","no" response for EDA, change name of column y
longdataeda <- longdata
longdataeda$y <- ifelse(longdata$y==1,"Yes","No")
names(longdataeda)[names(longdataeda) == "y"] <- "Byssinosis"
```

# 2. Exploratory Data Analysis

Here, we would establish preliminary assumptions on variable effects, and validate them afterwards with proper tests.

## 2.1 Employment

From the plot, it seems like the proportion of having byssinosis is higher for those between 10-19 of employment years.
```{r}
ggplot(longdataeda, aes(x= Employment, fill = Byssinosis)) + geom_bar(position = position_dodge())+
  labs(y= "Number of Workers", x="Employment Years", title = "Distribution of Byssinosis by Employment Years")
```

## 2.2 Smoking

From the plot, it seems like the proportion of having byssinosis is roughly the same across smokers and non smokers.
```{r}
ggplot(longdataeda, aes(x= Smoking, fill = Byssinosis)) + geom_bar(position = position_dodge())+
  labs(y= "Number of Workers", x="Smoking", title = "Distribution of Byssinosis by Smoking")
```

## 2.3 Sex

From the plot, it seems like the proportion of having byssinosis is roughly the same across males and females.
```{r}
ggplot(longdataeda, aes(x= Sex, fill = Byssinosis)) + geom_bar(position = position_dodge())+
  labs(y= "Number of Workers", x="Sex", title = "Distribution of Byssinosis by Sex")
```

## 2.4 Race

From the plot, it seems like the proportion of having byssinosis is higher for other races than white people.

```{r}
ggplot(longdataeda, aes(x= Race, fill = Byssinosis)) + geom_bar(position = position_dodge())+
  labs(y= "Number of Workers", x="Race", title = "Distribution of Byssinosis by Race")
```

## 2.5 Workspace

From the plot, it seems like the proportion of having byssinosis is the highest where the workspace is the most dusty, followed by less dusty and least dusty.

```{r}
ggplot(longdataeda, aes(x= Workspace, fill = Byssinosis)) + geom_bar(position = position_dodge())+
  labs(y= "Number of Workers", x="Workspace", title = "Distribution of Byssinosis by Workspace")
```

Overall, from the exploratory data analysis, 3 factors appear to contribute to having Byssinosis, particularly:

1. Employment years between 10-19

2. Non-white race

3. Most dusty workspace

Now, we will build a logistic regression model and evaluate these variables to test our hypothesis and observations. 

# 3. Variable Selection

Here, since our main goal is to build a logistic model focusing on investigating relationships and inference, we choose to use BIC over AIC as our criteria since it is easier for interpretations. AIC is more complicated and is only better if we want a better prediction result. 

## 3.1 USing Forward BIC

```{r}
forward_BIC <- step(glm(y~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "forward",
     k = log(dim(train)[1]))
forward_BIC
```

*Model selected: y ~ Workspace*

## 3.2 Using Both BIC

```{r}
both_BIC <- step(glm(y~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "both",
     k = log(dim(train)[1]))
summary(both_BIC)
```

*Model selected: y ~ Workspace*

Here, we see that both bidirectional and forward stepwise selection with BIC yielded the same model with Workspace as the only input variable. 

## 3.3 Testing for nonzero coefficients 

```{r}
testFit <- glm(both_BIC$model, binomial, test)
summary(testFit)
1-pchisq(608.03, 2706)
```

Using the Wald test with the test dataset, We see that the p values are close to zero, meaning that they are very significant and non zero. To briefly interpret the estimates, the magnitude of the estimates suggest the chance of having Byssinosis decreases less in workspace 1 (most dusty) than in workspaces 2 and 3 (less and least dusty.)

Additionally, from computing the 









