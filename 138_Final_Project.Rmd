---
title: "STA_138"
author: "Charles Chien"
date: "12/14/2020"
output: pdf_document
---

# Import & Modifying Dataset
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#import dataset
library(readr)
Byssinosis <- read_csv("Byssinosis.csv")

set.seed(123)
#create training set
train = Byssinosis %>% sample_frac(0.8)

#create testing set
test = Byssinosis %>% setdiff(train)

#create response variable for train
response_train = cbind(train$Byssinosis, train$`Non-Byssinosis`)

#create response variable for test
response_test = cbind(test$Byssinosis, test$`Non-Byssinosis`)

```

# Variable Selection

## Using Forward AIC
```{r}
forward_AIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "forward")
forward_AIC
```

Final Model: response_train ~ Workspace + Smoking + Employment + Workspace:Smoking + Workspace:Employment

## Using Both AIC
```{r}
both_AIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "both")
both_AIC
```

Final Model: response_train ~ Workspace + Smoking + Employment + Workspace:Smoking + Workspace:Employment

## USing Forward BIC
```{r}
forward_BIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "forward",
     k = log(dim(train)[1]))
forward_BIC
```

Final Model: response_train ~ Workspace + Smoking + Employment + Workspace:Smoking

## Using Both BIC
```{r}
both_BIC <- step(glm(response_train~1, binomial, train),
     scope = ~Employment*Smoking*Sex*Race*Workspace,
     direction = "both",
     k = log(dim(train)[1]))
both_BIC
```

Final Model: response_train ~ Workspace + Smoking + Employment + Workspace:Smoking


```{r}
Byssinosis1 <- aggregate(response_test ~ Workspace + Smoking + Employment + Workspace:Smoking + Workspace:Employment,FUN = sum, data = test)

fitGrouped <- glm(cbind(V1,V2)~Workspace + Smoking + Employment + Workspace:Smoking + Workspace:Employment, binomial, Byssinosis1)
summary(fitGrouped)

1-pchisq(0.196,2)


Byssinosis2 <- aggregate(response_test ~ Workspace + Smoking + Employment + Workspace:Smoking,FUN = sum, data = test)

fitGrouped <- glm(cbind(V1,V2)~Workspace + Smoking + Employment + Workspace:Smoking, binomial, Byssinosis2)
summary(fitGrouped)

1-pchisq(0.26609,3)
```
